import e,{useContext as t}from"react";import s from"@vista.io/vista-api-client";export{default as VistaClient}from"@vista.io/vista-api-client";import{withStyles as r}from"@mui/styles";import o from"@mui/material/Button";import a from"@mui/material/FormControl";import l from"@mui/material/InputLabel";import n from"@mui/material/List";import i from"@mui/material/ListItem";import c from"@mui/material/ListItemText";import d from"@mui/material/MenuItem";import m from"@mui/material/Select";import p from"@mui/material/ListItemButton";import h from"react-data-table-component";const u=e.createContext({secret:"",defaultClient:new s("","","")});class g extends e.Component{render(){const{secret:t,branch:r,hostname:o}=this.props,a=new s(t,r,o);return e.createElement(u.Provider,{value:{secret:this.props.secret,defaultClient:a}},this.props.children)}}class y extends e.Component{constructor(){super(...arguments),this.state={hasChecked:!1,granted:!1},this.componentDidMount=async()=>{if(!this.state.hasChecked){const e=this.context.defaultClient,t=(await e.users.check(this.props.userId,this.props.action,this.props.resourceId,this.props.resourceType,this.props.branch).catch((e=>{this.props.handleError?this.props.handleError(e):console.log(e)}))).length>0;t&&this.setState({hasChecked:!0,granted:t})}}}renderedComponent(){return this.state.hasChecked&&this.state.granted?this.props.children:this.props.denyComponent?this.props.denyComponent:null}render(){return e.createElement(e.Fragment,null,this.renderedComponent())}}y.contextType=u;function f(t){const{label:s,value:r,roles:o,onChange:n,className:i,style:c}=t;return e.createElement(a,{sx:{minWidth:"200px"}},e.createElement(l,null,s||""),e.createElement(m,{value:r,onChange:e=>n(e.target.value),label:s||"",className:i,style:c||{}},o.map((t=>e.createElement(d,{key:t.id,value:t.id}," ",t.id," ")))))}class b extends e.Component{constructor(e,t){super(e),this.grant=async(e,t)=>{const{resourceId:s,resourceType:r,branch:o,orgId:a,onGrant:l,onGrantError:n}=this.props;if(!l)return;const i={id:e,relation:t,resource_id:s,resource_type:r,branch:o},c=await l(i).catch((e=>{if(n)return n(e);console.log(e)}));if(c){const e=(await this.state.client.grants.listUnflattened(a)).filter((e=>"ROLE"===e.relation_type));this.setState({grants:e})}return c},this.state={client:t.defaultClient,selectedUserId:"",selectedRoleId:"",roles:[],grants:[]}}async componentDidMount(){const e=await this.state.client.roles.list(this.props.orgId),t=(await this.state.client.grants.listUnflattened(this.props.orgId)).filter((e=>"ROLE"===e.relation_type));this.setState({roles:e,grants:t})}render(){const{classes:t,styles:s,userIdMap:r}=this.props,{selectedUserId:p,selectedRoleId:h,roles:u,grants:g}=this.state;return e.createElement("div",{className:t.container,style:s.container},e.createElement("h1",{className:t.title,style:s.title}," Add Teammates "),e.createElement("div",{className:t.newGrantRow,style:s.newGrantRow},e.createElement("div",{className:t.userSelect,style:s.userSelect},e.createElement(a,{sx:{width:"100%"}},e.createElement(l,null,"Select User "),e.createElement(m,{value:p,onChange:e=>{this.setState({selectedUserId:e.target.value})},label:"Select User"},Object.entries(r).map((([t,s])=>e.createElement(d,{key:t,value:t}," ",s," ")))))),e.createElement("div",{className:t.roleSelect,style:s.roleSelect},e.createElement(f,{label:"Select Role",value:h,onChange:e=>{this.setState({selectedRoleId:e})},roles:u})),e.createElement(o,{className:t.grantButton,style:s.grantButton,variant:"contained",disabled:!(p.length&&h.length),onClick:async()=>{await this.grant(p,h)&&this.setState({selectedUserId:"",selectedRoleId:""})}},"Grant")),e.createElement("div",{className:t.grantList,style:s.grantList},e.createElement(n,null,g.map((r=>e.createElement(i,{key:`${r.userset_id}_${r.relation}`,className:t.grantRow,style:s.grantRow,secondaryAction:e.createElement(f,{value:r.relation,onChange:async e=>{await this.grant(r.userset_id,e)},className:t.grantRoleSelect,style:s.grantRoleSelect,roles:u})},e.createElement(c,{primary:r.userset_id})))))))}}b.contextType=u,b.defaultProps={styles:{}};const x=r({container:{height:"500px",width:"600px",display:"flex",flexDirection:"column",border:"solid",borderColor:"lightgray",borderWidth:"1px",padding:"50px",marginBottom:"50px"},title:{marginTop:"0px"},newGrantRow:{display:"flex",marginBottom:"20px"},userSelect:{flexGrow:"1",marginRight:"10px"},roleSelect:{marginRight:"10px"},grantButton:{},grantRow:{height:"75px"},grantList:{flexGrow:"1",width:"100%",padding:"0",border:"solid",borderColor:"lightgray",borderWidth:"1px",overflow:"scroll",margin:"0"},grantRoleSelect:{}})(b);function w(t){const{row:s,classes:r,text:o}=t,a=t.styles||r;return e.createElement("p",{className:s.inheritedFrom?r.permissionsTableRowInherited:r.permissionsTableRow,style:s.inheritedFrom?a.permissionsTableRowInherited:a.permissionsTableRow}," ",o," ")}function _(t){const{classes:s,styles:r,title:o}=t;return e.createElement("div",{className:s.permissionsTable},e.createElement(h,{title:o,columns:[{name:"Resource Type",selector:()=>"resourceType",sortable:!0,cell:t=>e.createElement(w,{text:t.resourceType,classes:s,styles:r,row:t})},{name:"Attribute",selector:()=>"attribute",sortable:!0,right:!0,cell:t=>e.createElement(w,{text:t.attribute,classes:s,styles:r,row:t})},{name:"Actions",selector:()=>"actions",sortable:!0,right:!0,cell:t=>e.createElement(w,{text:t.actions.join(", "),classes:s,styles:r,row:t})},{name:"Inherited From",selector:()=>"inheritedFrom",sortable:!0,right:!0,cell:t=>e.createElement(w,{text:t.inheritedFrom,classes:s,styles:r,row:t})}],data:(()=>{const{rolesById:e,role:s}=t;if(!s)return[];const r={},o=[...s.parent_roles],a=new Set,l=[];for(;o.length;){const t=o.shift();if(!t||a.has(t))continue;a.add(t);const s=e[t];for(const e in s.resource_types_to_attributes_to_actions)for(const t in s.resource_types_to_attributes_to_actions[e]){const o=s.resource_types_to_attributes_to_actions[e][t],a=`${e}_${t}`;r[a]||(l.push({actions:o,attribute:t,id:a,resourceType:e,inheritedFrom:s.id}),r[a]=!0)}o.push(...s.parent_roles)}for(const e in s.resource_types_to_attributes_to_actions)for(const t in s.resource_types_to_attributes_to_actions[e]){const o=`${e}_${t}`,a=s.resource_types_to_attributes_to_actions[e][t];r[o]||(l.push({id:o,actions:a,attribute:t,resourceType:e,inheritedFrom:""}),r[o]=!0)}return l})()}))}class E extends e.Component{constructor(e,t){super(e),this.state={client:t.defaultClient,rolesById:{},selectedRoleId:""}}async componentDidMount(){const e=await this.state.client.roles.list(this.props.orgId),t={};e.forEach((e=>{t[e.id]=e}));const s=e.length?e[0].id:"";this.setState({rolesById:t,selectedRoleId:s})}render(){const{classes:t}=this.props,s=this.props.styles||t,{rolesById:r,selectedRoleId:o}=this.state;return e.createElement("div",{className:t.container,style:s.container},e.createElement(n,{className:t.rolesList,style:s.rolesList,disablePadding:!0},Object.values(r).map((r=>e.createElement(i,{key:r.id,disablePadding:!0},e.createElement(p,{className:t.rolesListRow,style:s.rolesListRow,selected:o===r.id,disableRipple:!0,onClick:()=>this.setState({selectedRoleId:r.id})},e.createElement(c,{primary:r.id})))))),e.createElement(_,{title:`${o} Permissions`,rolesById:r,role:r[o],classes:t,styles:s}))}}E.contextType=u,E.defaultProps={styles:{}};const R=r({container:{height:"500px",width:"1000px",display:"flex",border:"solid",borderColor:"lightgray",borderWidth:"1px"},title:{marginTop:"0px"},rolesList:{height:"100%",width:"200px",overflow:"scroll",borderRight:"1px solid lightgray"},rolesListRow:{height:"60px"},rolesListRowText:{fontSize:"100px"},permissionsTable:{height:"100%",flexGrow:"1"},permissionsTableRowInherited:{color:"grey"},permissionsTableRow:{}})(E),I=()=>t(u).defaultClient;export{y as VistaCheck,u as VistaContext,x as VistaGrant,g as VistaProvider,R as VistaRoles,I as useVistaClient};
//# sourceMappingURL=index.js.map
