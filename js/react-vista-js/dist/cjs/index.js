"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@vista.io/vista-api-client"),s=require("@mui/styles"),r=require("@mui/material/Button"),a=require("@mui/material/FormControl"),l=require("@mui/material/InputLabel"),o=require("@mui/material/List"),n=require("@mui/material/ListItem"),i=require("@mui/material/ListItemText"),c=require("@mui/material/MenuItem"),d=require("@mui/material/Select"),u=require("@mui/material/ListItemButton"),p=require("react-data-table-component");function m(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=m(e),f=m(t),y=m(r),g=m(a),x=m(l),b=m(o),w=m(n),_=m(i),E=m(c),R=m(d),C=m(u),I=m(p);const v=h.default.createContext({secret:"",defaultClient:new f.default("","","")});class S extends h.default.Component{render(){const{secret:e,branch:t,hostname:s}=this.props,r=new f.default(e,t,s);return h.default.createElement(v.Provider,{value:{secret:this.props.secret,defaultClient:r}},this.props.children)}}class T extends h.default.Component{constructor(){super(...arguments),this.state={hasChecked:!1,granted:!1},this.componentDidMount=async()=>{if(!this.state.hasChecked){const e=this.context.defaultClient,t=(await e.users.check(this.props.userId,this.props.action,this.props.resourceId,this.props.resourceType,this.props.branch).catch((e=>{this.props.handleError?this.props.handleError(e):console.log(e)}))).length>0;t&&this.setState({hasChecked:!0,granted:t})}}}renderedComponent(){return this.state.hasChecked&&this.state.granted?this.props.children:this.props.denyComponent?this.props.denyComponent:null}render(){return h.default.createElement(h.default.Fragment,null,this.renderedComponent())}}T.contextType=v;function L(e){const{label:t,value:s,roles:r,onChange:a,className:l,style:o}=e;return h.default.createElement(g.default,{sx:{minWidth:"200px"}},h.default.createElement(x.default,null,t||""),h.default.createElement(R.default,{value:s,onChange:e=>a(e.target.value),label:t||"",className:l,style:o||{}},r.map((e=>h.default.createElement(E.default,{key:e.id,value:e.id}," ",e.id," ")))))}class N extends h.default.Component{constructor(e,t){super(e),this.grant=async(e,t)=>{const{resourceId:s,resourceType:r,branch:a,orgId:l,onGrant:o,onGrantError:n}=this.props;if(!o)return;const i={id:e,relation:t,resource_id:s,resource_type:r,branch:a},c=await o(i).catch((e=>{if(n)return n(e);console.log(e)}));if(c){const e=(await this.state.client.grants.listUnflattened(l)).filter((e=>"ROLE"===e.relation_type));this.setState({grants:e})}return c},this.state={client:t.defaultClient,selectedUserId:"",selectedRoleId:"",roles:[],grants:[]}}async componentDidMount(){const e=await this.state.client.roles.list(this.props.orgId),t=(await this.state.client.grants.listUnflattened(this.props.orgId)).filter((e=>"ROLE"===e.relation_type));this.setState({roles:e,grants:t})}render(){const{classes:e,styles:t,userIdMap:s}=this.props,{selectedUserId:r,selectedRoleId:a,roles:l,grants:o}=this.state;return h.default.createElement("div",{className:e.container,style:t.container},h.default.createElement("h1",{className:e.title,style:t.title}," Add Teammates "),h.default.createElement("div",{className:e.newGrantRow,style:t.newGrantRow},h.default.createElement("div",{className:e.userSelect,style:t.userSelect},h.default.createElement(g.default,{sx:{width:"100%"}},h.default.createElement(x.default,null,"Select User "),h.default.createElement(R.default,{value:r,onChange:e=>{this.setState({selectedUserId:e.target.value})},label:"Select User"},Object.entries(s).map((([e,t])=>h.default.createElement(E.default,{key:e,value:e}," ",t," ")))))),h.default.createElement("div",{className:e.roleSelect,style:t.roleSelect},h.default.createElement(L,{label:"Select Role",value:a,onChange:e=>{this.setState({selectedRoleId:e})},roles:l})),h.default.createElement(y.default,{className:e.grantButton,style:t.grantButton,variant:"contained",disabled:!(r.length&&a.length),onClick:async()=>{await this.grant(r,a)&&this.setState({selectedUserId:"",selectedRoleId:""})}},"Grant")),h.default.createElement("div",{className:e.grantList,style:t.grantList},h.default.createElement(b.default,null,o.map((s=>h.default.createElement(w.default,{key:`${s.userset_id}_${s.relation}`,className:e.grantRow,style:t.grantRow,secondaryAction:h.default.createElement(L,{value:s.relation,onChange:async e=>{await this.grant(s.userset_id,e)},className:e.grantRoleSelect,style:t.grantRoleSelect,roles:l})},h.default.createElement(_.default,{primary:s.userset_id})))))))}}N.contextType=v,N.defaultProps={styles:{}};const q=s.withStyles({container:{height:"500px",width:"600px",display:"flex",flexDirection:"column",border:"solid",borderColor:"lightgray",borderWidth:"1px",padding:"50px",marginBottom:"50px"},title:{marginTop:"0px"},newGrantRow:{display:"flex",marginBottom:"20px"},userSelect:{flexGrow:"1",marginRight:"10px"},roleSelect:{marginRight:"10px"},grantButton:{},grantRow:{height:"75px"},grantList:{flexGrow:"1",width:"100%",padding:"0",border:"solid",borderColor:"lightgray",borderWidth:"1px",overflow:"scroll",margin:"0"},grantRoleSelect:{}})(N);function k(e){const{row:t,classes:s,text:r}=e,a=e.styles||s;return h.default.createElement("p",{className:t.inheritedFrom?s.permissionsTableRowInherited:s.permissionsTableRow,style:t.inheritedFrom?a.permissionsTableRowInherited:a.permissionsTableRow}," ",r," ")}function B(e){const{classes:t,styles:s,title:r}=e;return h.default.createElement("div",{className:t.permissionsTable},h.default.createElement(I.default,{title:r,columns:[{name:"Resource Type",selector:()=>"resourceType",sortable:!0,cell:e=>h.default.createElement(k,{text:e.resourceType,classes:t,styles:s,row:e})},{name:"Attribute",selector:()=>"attribute",sortable:!0,right:!0,cell:e=>h.default.createElement(k,{text:e.attribute,classes:t,styles:s,row:e})},{name:"Actions",selector:()=>"actions",sortable:!0,right:!0,cell:e=>h.default.createElement(k,{text:e.actions.join(", "),classes:t,styles:s,row:e})},{name:"Inherited From",selector:()=>"inheritedFrom",sortable:!0,right:!0,cell:e=>h.default.createElement(k,{text:e.inheritedFrom,classes:t,styles:s,row:e})}],data:(()=>{const{rolesById:t,role:s}=e;if(!s)return[];const r={},a=[...s.parent_roles],l=new Set,o=[];for(;a.length;){const e=a.shift();if(!e||l.has(e))continue;l.add(e);const s=t[e];for(const e in s.resource_types_to_attributes_to_actions)for(const t in s.resource_types_to_attributes_to_actions[e]){const a=s.resource_types_to_attributes_to_actions[e][t],l=`${e}_${t}`;r[l]||(o.push({actions:a,attribute:t,id:l,resourceType:e,inheritedFrom:s.id}),r[l]=!0)}a.push(...s.parent_roles)}for(const e in s.resource_types_to_attributes_to_actions)for(const t in s.resource_types_to_attributes_to_actions[e]){const a=`${e}_${t}`,l=s.resource_types_to_attributes_to_actions[e][t];r[a]||(o.push({id:a,actions:l,attribute:t,resourceType:e,inheritedFrom:""}),r[a]=!0)}return o})()}))}class G extends h.default.Component{constructor(e,t){super(e),this.state={client:t.defaultClient,rolesById:{},selectedRoleId:""}}async componentDidMount(){const e=await this.state.client.roles.list(this.props.orgId),t={};e.forEach((e=>{t[e.id]=e}));const s=e.length?e[0].id:"";this.setState({rolesById:t,selectedRoleId:s})}render(){const{classes:e}=this.props,t=this.props.styles||e,{rolesById:s,selectedRoleId:r}=this.state;return h.default.createElement("div",{className:e.container,style:t.container},h.default.createElement(b.default,{className:e.rolesList,style:t.rolesList,disablePadding:!0},Object.values(s).map((s=>h.default.createElement(w.default,{key:s.id,disablePadding:!0},h.default.createElement(C.default,{className:e.rolesListRow,style:t.rolesListRow,selected:r===s.id,disableRipple:!0,onClick:()=>this.setState({selectedRoleId:s.id})},h.default.createElement(_.default,{primary:s.id})))))),h.default.createElement(B,{title:`${r} Permissions`,rolesById:s,role:s[r],classes:e,styles:t}))}}G.contextType=v,G.defaultProps={styles:{}};const F=s.withStyles({container:{height:"500px",width:"1000px",display:"flex",border:"solid",borderColor:"lightgray",borderWidth:"1px"},title:{marginTop:"0px"},rolesList:{height:"100%",width:"200px",overflow:"scroll",borderRight:"1px solid lightgray"},rolesListRow:{height:"60px"},rolesListRowText:{fontSize:"100px"},permissionsTable:{height:"100%",flexGrow:"1"},permissionsTableRowInherited:{color:"grey"},permissionsTableRow:{}})(G);Object.defineProperty(exports,"VistaClient",{enumerable:!0,get:function(){return f.default}}),exports.VistaCheck=T,exports.VistaContext=v,exports.VistaGrant=q,exports.VistaProvider=S,exports.VistaRoles=F,exports.useVistaClient=()=>e.useContext(v).defaultClient;
//# sourceMappingURL=index.js.map
